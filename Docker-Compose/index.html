<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Orquestração de Containers com Docker Compose - MDS-EPS</title>
        <link href="../css/bootstrap-custom.min.css" rel="stylesheet">
        <link href="../css/font-awesome-4.5.0.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="../css/highlight.css">
        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
            <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
        <![endif]-->

        <script src="../js/jquery-1.10.2.min.js"></script>
        <script src="../js/bootstrap-3.0.3.min.js"></script>
        <script src="../js/highlight.pack.js"></script> 
    </head>

    <body>

        <div class="navbar navbar-default navbar-fixed-top" role="navigation">
    <div class="container">

        <!-- Collapsed navigation -->
        <div class="navbar-header">
            <!-- Expander button -->
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="..">MDS-EPS</a>
        </div>

        <!-- Expanded navigation -->
        <div class="navbar-collapse collapse">
                <!-- Main navigation -->
                <ul class="nav navbar-nav">
                    <li >
                        <a href="..">Home</a>
                    </li>
                    <li >
                        <a href="../Projetos----Temas/">Temas</a>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Disciplinas <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Métodos-de-Desenvolvimento-de-Software/">Métodos de Desenvolvimento de Software</a>
</li>
                            
<li >
    <a href="../Gestão-de-Portfólios-e-Projetos-de-Software/">Gestão de Portfólio e Projetos de Software</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Métodos Ágeis <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Scrum/">Scrum</a>
</li>
                            
<li >
    <a href="../Programação-Extrema-(XP)/">Programação Extrema (XP)</a>
</li>
                            
<li >
    <a href="../Indicadores-Ágeis/">Indicadores Ágeis</a>
</li>
                            
<li >
    <a href="../Como-pontuar-o-backlog/">Como pontuar o backlog</a>
</li>
                            
<li >
    <a href="../Como-melhorar-a-comunicação-da-equipe/">Como melhorar a comunicação</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Programação Extrema (XP) <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Pair-Programming/">Pair Programming</a>
</li>
                            
<li >
    <a href="../Test-Driven-Development/">Test Driven Development</a>
</li>
                            
<li >
    <a href="../Acceptance-Test-Driven-Development-(ATDD)/">Acceptance Test Driven Development (ATDD)</a>
</li>
                            
<li >
    <a href="../Refactoring/">Refactoring</a>
</li>
                            
<li >
    <a href="../Integração-Contínua/">Integração continua</a>
</li>
                            
<li >
    <a href="../Integração-Contínua---Deploy-Contínuo/">Integração Contínua Deploy Contínuo</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown active">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">DevOps <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Automações/">Automações</a>
</li>
                            
<li >
    <a href="../Configuracao-de-ambiente-virtual-utilizando-docker/">Automação de Ambiente com Docker</a>
</li>
                            
<li class="active">
    <a href="./">Orquestração de Containers com Docker Compose</a>
</li>
                            
<li >
    <a href="../Configuração-de-um-ambiente-virtual-utilizando-o-Vagrant/">Automação de Ambiente com Vagrant</a>
</li>
                            
<li >
    <a href="../Deploy-Contínuo/">Deploy Contínuo na Plataforma Heroku</a>
</li>
                            
<li >
    <a href="../Integração-Contínua-Travis-CI/">Integração Contínua com Travis CI</a>
</li>
                            
<li >
    <a href="../Colocando-a-aplicação-em-produção-com-NGINX/">Disponibilizando a Aplicação com o Proxy Reverso Nginx</a>
</li>
                        </ul>
                    </li>
                    <li class="dropdown">
                        <a href="#" class="dropdown-toggle" data-toggle="dropdown">Tutoriais <b class="caret"></b></a>
                        <ul class="dropdown-menu">
                            
<li >
    <a href="../Git/">Tutorial Git</a>
</li>
                            
<li >
    <a href="../Configuração-de-Ambiente/">Tutorial de Instalação do Ionic</a>
</li>
                            
<li >
    <a href="../Android---Circle-Continuous-Integration-(Unit-Tests,-UI-Tests,-Coverage-build-pass-rule,-beta-deploy-and-production-deploy-automated)/">Android Integração contínua com Circle CI</a>
</li>
                            
<li >
    <a href="../Configuração-de-Ambiente-para-React-Native/">Configuração de Ambiente para React Native</a>
</li>
                            
<li >
    <a href="../Rails/">Tutorial Instalação Ruby on Rails</a>
</li>
                            
<li >
    <a href="../REST-API-em-Node.js-e-RethinkDB/">Tutorial REST API em Node.js</a>
</li>
                            
<li >
    <a href="../Teste-Automatizado-Cucumber-JS/">Teste Automatizado Cucumber JS</a>
</li>
                            
<li >
    <a href="../Teste-Automatizado-Cucumber-Rails/">Teste Automatizado Cucumber Rails</a>
</li>
                            
<li >
    <a href="../Teste-Automatizado-com-Selenium-IDE/">Teste Automatizado com Selenium IDE</a>
</li>
                        </ul>
                    </li>
                </ul>

            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a href="#" data-toggle="modal" data-target="#mkdocs_search_modal">
                        <i class="fa fa-search"></i> Search
                    </a>
                </li>
                    <li >
                        <a rel="next" href="../Configuracao-de-ambiente-virtual-utilizando-docker/">
                            <i class="fa fa-arrow-left"></i> Previous
                        </a>
                    </li>
                    <li >
                        <a rel="prev" href="../Configuração-de-um-ambiente-virtual-utilizando-o-Vagrant/">
                            Next <i class="fa fa-arrow-right"></i>
                        </a>
                    </li>
            </ul>
        </div>
    </div>
</div>

        <div class="container">
                <div class="col-md-3"><div class="bs-sidebar hidden-print affix well" role="complementary">
    <ul class="nav bs-sidenav">
        <li class="main active"><a href="#orquestracao-de-containers-com-docker-compose">Orquestração de Containers com Docker Compose</a></li>
            <li><a href="#1-sobre-o-docker-compose">1. Sobre o Docker Compose</a></li>
            <li><a href="#2-configuracao">2. Configuração</a></li>
            <li><a href="#3-executando-o-docker-compose">3. Executando o Docker Compose</a></li>
    </ul>
</div></div>
                <div class="col-md-9" role="main">

<h1 id="orquestracao-de-containers-com-docker-compose">Orquestração de Containers com Docker Compose</h1>
<h2 id="1-sobre-o-docker-compose">1. Sobre o Docker Compose</h2>
<p>O docker compose é uma ferramenta para orquestrar e executar diversos container <a href="https://www.docker.com/">docker</a>. Auxilia na organização evitando imensas linhas de comando docker com muitas passagens de parâmetros. 
<p align="left">
[[img/logos/docker-compose-logo.png |height = 250px]]
</p></p>
<h2 id="2-configuracao">2. Configuração</h2>
<h3 id="21-o-arquivo-yml">2.1. O arquivo yml</h3>
<p>O compose usa um arquivo de configuração chamado <code>docker-compose.yml</code>, nesse arquivo define-se os serviços que serão levantados pelo compose. Os serviços usam uma imagem base, podendo ser criada a partir de um <code>Dockerfile</code> ou baixada do <a href="https://hub.docker.com/">docker hub</a>. Veja o exemplo abaixo:</p>
<pre><code class="yml">version: '3'

services:
  redis:
    build: .
    ports:
      - &quot;6379:6379&quot;
</code></pre>

<p>No exemplo, cria-se um serviço <code>redis</code> utilizando o <code>Dockerfile</code> que se encontra na mesma pasta que o docker-compose.yml indicado pelo caractere <code>.</code>. Poderia-se também utilizar a imagem oficial do redis disponivel no docker hub, basta substituir o <code>build: .</code> por <code>image: redis</code>, onde o valor <code>redis</code> na chave refere-se ao nome da imagem.</p>
<h3 id="22-chaves-basicas">2.2. Chaves básicas</h3>
<h4 id="221-ports">2.2.1. ports</h4>
<p>A comunicação com um container é normalmente feita via porta exposta. No exemplo acima, a porta <code>6379</code> do container é mapeada para a porta de mesmo número do <code>host</code>. Isto significa que ao acessar a porta 6379 no localhost o conteúdo apresentado refere-se à aplicação em execução no container. </p>
<p>O mapeamento é iniciado pela porta do host seguida pela porta do container: <code>"host:conatainer"</code>.</p>
<h4 id="222-volumes">2.2.2. volumes</h4>
<p>Arquivos e pastas podem ser compartilhados entre o host e um container, ou entre containers, usando volumes. No <code>docker-compose.yml</code> o mapeamento de volume é feita com o uso da chave <code>volumes</code>. No exemplo, o arquivo <code>nginx.conf</code> é compartilhado com o container <code>nginx</code>. Dessa forma será possível executar alterações nas configurações do <code>nginx</code> diretamente do host, de forma que essas mudanças são refletidas no arquivo <code>nginx.conf</code> do container.</p>
<pre><code class="yml">services:
  nginx:
    image: nginx
    ports:
      - &quot;80:80&quot;
    volumes:
      - ./nginx.conf:/etc/nginx/nginx.conf
</code></pre>

<h4 id="223-depends_on">2.2.3. depends_on</h4>
<p>Muitas vezes é preciso subir containers em uma ordem específica por questões de dependência. A chave <code>depends_on</code> evita que um container suba antes de suas dependencias estarem em execução. No exemplo, o serviço <code>web</code> irá esperar o serviço <code>redis</code> para iniciar.</p>
<pre><code class="yml">  web:
    build: .
    ports:
      - &quot;8000:8000&quot;
    depends_on:
      - redis
</code></pre>

<h4 id="224-command">2.2.4. command</h4>
<p>Esta chave executa o comando passado como seu valor assim que o container está em execução. No exemplo, ao terminar a build da imagem, será levantado o servidor do django.</p>
<pre><code class="yml">  web:
    build: .
    command: python3 manage.py runserver 0.0.0.0:8000
</code></pre>

<h4 id="225-environment">2.2.5. environment</h4>
<p>Variáveis de ambiente podem ser passadas aos containers usando a chave <code>enviroment</code>, como no exemplo abaixo:</p>
<pre><code class="yml">postgres:
    image: postgres
    environment:
        POSTGRES_PASSWORD: 1234
        POSTGRES_DB: postgres
        POSTGRES_USER: eu
</code></pre>

<p>Porém, por questões de seguraça não é legal expor senhas desta maneira. Mas, ao usar outra chave chamada <code>env_file</code>, é possível externalizar as variáveis para um arquivo <code>.env</code> e utilizá-lo como a seguir:</p>
<pre><code class="yml">web:
  env_file:
    - web-variables.env
</code></pre>

<h2 id="3-executando-o-docker-compose">3. Executando o Docker Compose</h2>
<p>Após configurado o docker-compose.yml, pode-se executar e subir todos os serviços com o comando:</p>
<pre><code>docker-compose up
</code></pre>

<h3 id="31-comandos-uteis">3.1. Comandos úteis:</h3>
<ul>
<li><code>docker-compose up</code> : Constrói as imagens, (re)cria, inicia e anexa containers a um serviço. A flag <code>-d</code> executa os cantainers em segundo plano. </li>
<li><code>docker-compose down</code> : Termina a execução dos containers, os remove e remove networks e volumes criados por <code>up</code>. </li>
<li><code>docker-compose stop</code> : Termina a execução dos containers sem removê-los. </li>
<li><code>docker-compose start</code> : Inicia containers existentes para um serviço. </li>
<li><code>docker-compose logs</code> : Exibe saída de log dos serviços, a flag <code>-f</code> segue a saída de log. </li>
<li><code>docker-compose exec web bash</code> : Executa o comado <code>bash</code> no serviço <code>web</code>. </li>
</ul>
<p>Obs: Estes comandos exigem sudo, a menos, que tenha configurado para que não.</p></div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="http://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script>var base_url = '..';</script>
        <script src="../js/base.js"></script>
        <script src="../search/require.js"></script>
        <script src="../search/search.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="Search Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Search</h4>
            </div>
            <div class="modal-body">
                <p>
                    From here you can search these documents. Enter
                    your search terms below.
                </p>
                <form role="form">
                    <div class="form-group">
                        <input type="text" class="form-control" placeholder="Search..." id="mkdocs-search-query">
                    </div>
                </form>
                <div id="mkdocs-search-results"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="Keyboard Shortcuts Modal" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                <h4 class="modal-title" id="exampleModalLabel">Keyboard Shortcuts</h4>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td><kbd>&larr;</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td><kbd>&rarr;</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>


    </body>
</html>
